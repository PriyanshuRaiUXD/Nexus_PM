<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus PM - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        .sidebar {
            transition: width 0.3s ease-in-out;
        }
        .sidebar-collapsed {
            width: 5rem; /* 80px */
        }
        .sidebar-expanded {
            width: 16rem; /* 256px */
        }
        #sidebar.sidebar-collapsed nav a, #sidebar.sidebar-collapsed #user-profile-container {
            justify-content: center;
        }
        .bento-box {
            background-color: #ffffff; /* white */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.5rem;
            border: 1px solid #e2e8f0; /* slate-200 */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        #ai-response-container {
            transition: all 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        #ai-response-container.expanded {
            max-height: 50vh;
        }
        #ai-response-container.minimized {
            max-height: 4rem;
        }
        #ai-response-container.minimized #message-list {
            display: none;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .task-checkbox:checked + .task-label {
            text-decoration: line-through;
            color: #64748b; /* slate-500 */
        }
        .modal-overlay {
            background-color: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(4px);
        }
        #live-feed .feed-item:last-child .timeline-line {
            display: none;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar sidebar-collapsed bg-white border-r border-slate-200 flex flex-col h-full">
        <!-- Logo -->
        <div class="flex items-center justify-center p-4 h-16 border-b border-slate-200">
            <h1 id="logo-text" class="text-2xl font-bold text-slate-800 transition-opacity duration-300">N<span class="text-blue-600">P</span></h1>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-4 space-y-2">
            <a href="index.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="home" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Home</span>
            </a>
            <a href="projects.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="folder-kanban" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Projects</span>
            </a>
            <a href="goals.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="target" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Goals</span>
            </a>
            <a href="intelligence.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="bar-chart-big" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Intelligence</span>
            </a>
             <a href="chat-history.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="message-square" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Chat History</span>
            </a>
            <a href="activity.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="activity" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Activity</span>
            </a>
            <a href="settings.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="settings" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Settings</span>
            </a>
        </nav>

        <!-- User Profile -->
        <div class="p-4 border-t border-slate-200">
             <div id="user-profile-container" class="flex items-center">
                <img src="https://i.pravatar.cc/40?u=nexus-user" alt="User Avatar" class="rounded-full h-10 w-10">
                <div class="ml-3 overflow-hidden nav-text hidden">
                    <p class="font-semibold text-slate-800 text-sm truncate">Alex Hartman</p>
                    <p class="text-xs text-slate-500 truncate">Product Manager</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 bg-slate-50 flex flex-col overflow-hidden">
        <div id="main-content" class="flex-1 overflow-y-auto overflow-x-hidden p-8">
            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900">Welcome back, Alex</h1>
                    <p class="text-slate-500 mt-1">Here's your mission control for today.</p>
                </div>
                <div class="relative">
                    <button id="notification-bell" class="p-2 rounded-full hover:bg-slate-200 relative">
                        <i data-lucide="bell" class="h-6 w-6 text-slate-600"></i>
                        <span class="absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
                    </button>
                    <div id="notification-panel" class="hidden absolute top-full right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border z-10">
                        <div class="p-3 border-b font-semibold text-sm">Notifications</div>
                        <div class="max-h-80 overflow-y-auto custom-scrollbar">
                           <a href="#" class="block p-3 hover:bg-slate-50 border-b"><p class="text-xs font-bold text-yellow-600">RISK DETECTED</p><p class="text-sm">Budget variance increased to +15% on <strong>Phoenix Project</strong>.</p><p class="text-xs text-slate-400 mt-1">2 hours ago</p></a>
                           <a href="#" class="block p-3 hover:bg-slate-50 border-b"><p class="text-xs font-bold text-blue-600">NEW COMMENT</p><p class="text-sm"><strong>Laura</strong> commented on an issue in <strong>Phoenix Project</strong>.</p><p class="text-xs text-slate-400 mt-1">5 hours ago</p></a>
                           <a href="#" class="block p-3 hover:bg-slate-50"><p class="text-xs font-bold text-green-600">FILE UPLOADED</p><p class="text-sm"><strong>Samantha</strong> uploaded a new file to <strong>Orion App</strong>.</p><p class="text-xs text-slate-400 mt-1">Yesterday</p></a>
                        </div>
                        <a href="activity.html" class="block text-center p-2 text-sm font-medium text-blue-600 hover:bg-slate-50 rounded-b-lg">View all activity</a>
                    </div>
                </div>
            </header>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- AI Daily Briefing -->
                <div class="lg:col-span-4 bento-box bg-blue-50 border-blue-200">
                    <div class="flex items-center space-x-2 mb-2"><i data-lucide="sparkles" class="h-6 w-6 text-blue-500"></i><h2 class="text-xl font-semibold text-slate-900">AI Daily Briefing</h2></div>
                    <p class="text-sm text-slate-700">Good afternoon, Alex. Your portfolio health is strong at <strong>85/100</strong>, but the overall budget is trending <strong>8% over</strong>. The most critical issue is <strong>Laura's workload</strong>, which is now blocking the Phoenix Project. My top recommendation is to reassign her "Refactor payment gateway" task.</p>
                </div>

                <!-- Personal Hub -->
                <div class="lg:col-span-2 row-span-2 bento-box flex flex-col">
                     <h2 class="text-xl font-semibold text-slate-900 mb-4">Personal Hub</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
                        <!-- Action Items -->
                        <div>
                            <div id="task-list" class="space-y-3">
                                <p class="text-xs font-semibold text-slate-400 uppercase">ACTION ITEMS</p>
                                <div class="flex items-center justify-between"><div class="flex items-center"><input type="checkbox" id="task1" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3 task-checkbox"><label for="task1" class="font-medium text-sm task-label">Review API schema</label></div><span class="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full">Due Today</span></div>
                                <div class="flex items-center justify-between"><div class="flex items-center"><input type="checkbox" id="task2" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3 task-checkbox"><label for="task2" class="font-medium text-sm task-label">Sync with stakeholders</label></div><span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full">Due Tomorrow</span></div>
                            </div>
                            <form id="new-task-form" class="mt-4 border-t pt-4"><div class="relative"><input type="text" id="new-task-input" placeholder="Add a new action item..." class="w-full text-sm border-slate-300 rounded-lg py-2 pl-3 pr-10"><button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 p-1 text-slate-400 hover:text-blue-600"><i data-lucide="plus-circle" class="h-5 w-5"></i></button></div></form>
                        </div>
                        <!-- Quick Notes -->
                        <div class="flex flex-col">
                            <h3 class="text-xs font-semibold text-slate-400 uppercase mb-2">QUICK NOTES</h3>
                            <textarea id="quick-notes-textarea" class="w-full flex-1 text-sm bg-slate-50 p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 no-scrollbar" placeholder="Jot down a quick thought..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Live Feed -->
                <div class="lg:col-span-2 row-span-2 bento-box flex flex-col">
                     <h2 class="text-xl font-semibold text-slate-900 mb-4">Live Feed from Connected Apps</h2>
                     <div id="live-feed" class="flex-1 -mx-2 space-y-1 overflow-y-auto custom-scrollbar">
                        <!-- Feed items will be injected here -->
                     </div>
                </div>

                <!-- AI Driven Recommendations -->
                <div class="lg:col-span-1 bento-box">
                    <h2 class="text-xl font-semibold text-slate-900 mb-4">AI Recommendations</h2>
                    <div class="space-y-3">
                        <div class="flex items-start bg-slate-50 p-3 rounded-lg"><i data-lucide="users" class="h-5 w-5 text-red-500 mr-3 mt-1 flex-shrink-0"></i><div><p class="font-semibold text-sm text-slate-800">De-risk Laura's Workload</p><p class="text-xs text-slate-600">Laura is at 110% capacity. Reassign her task to David to prevent burnout.</p></div></div>
                        <div class="flex items-start bg-slate-50 p-3 rounded-lg"><i data-lucide="dollar-sign" class="h-5 w-5 text-yellow-500 mr-3 mt-1 flex-shrink-0"></i><div><p class="font-semibold text-sm text-slate-800">Review Phoenix Budget</p><p class="text-xs text-slate-600">The Phoenix Project is 15% over budget. Review recent software costs.</p></div></div>
                    </div>
                </div>

                 <!-- Upcoming Milestones -->
                <div class="lg:col-span-1 bento-box">
                    <h2 class="text-xl font-semibold text-slate-900 mb-4">Upcoming Milestones</h2>
                    <div class="space-y-3">
                        <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-green-500 mr-3"></div><div><p class="font-medium text-sm">Orion App Launch</p><p class="text-xs text-slate-500">in 2 days</p></div></div>
                        <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-yellow-500 mr-3"></div><div><p class="font-medium text-sm">Phoenix DB Migration</p><p class="text-xs text-slate-500">in 9 days</p></div></div>
                        <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-red-500 mr-3"></div><div><p class="font-medium text-sm">Vega Initiative Review</p><p class="text-xs text-slate-500">in 23 days</p></div></div>
                    </div>
                </div>

                 <!-- Priority Email -->
                <div class="lg:col-span-2 bento-box flex flex-col">
                    <h2 class="text-xl font-semibold text-slate-900 mb-4">Priority Email</h2>
                    <div class="flex-1 space-y-3">
                        <div class="flex items-center"><img src="https://i.pravatar.cc/32?u=stakeholder" class="h-8 w-8 rounded-full mr-3"><div><p class="font-semibold text-sm">Eleanor Vance</p><p class="text-xs text-slate-500">Feedback on latest designs</p></div></div>
                        <p class="text-xs text-slate-600 bg-slate-50 p-3 rounded-lg border">"Hi Alex, a few points of feedback on the latest designs for the Orion App. Overall it's looking good, but I'm concerned about the complexity of the new user onboarding flow..."</p>
                        <div id="ai-email-analysis" class="hidden text-xs text-blue-800 bg-blue-50 p-3 rounded-lg"><strong>AI Analysis:</strong> Positive sentiment with a key concern around 'user onboarding complexity'. Recommends acknowledging the feedback and suggesting a brief follow-up meeting.</div>
                    </div>
                    <div class="mt-4 border-t pt-4 flex justify-between items-center">
                        <a href="mailto:eleanor.vance@example.com?subject=Re:%20Feedback%20on%20latest%20designs" class="text-sm font-medium text-blue-600 hover:underline">View Email →</a>
                        <div class="flex space-x-2">
                           <button id="analyze-email-btn" title="Analyze with AI" class="p-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-lg"><i data-lucide="brain-circuit" class="h-4 w-4"></i></button>
                           <button id="draft-reply-btn" title="Reply with Nexus AI" class="p-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg"><i data-lucide="pen-square" class="h-4 w-4"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Response Container -->
        <div id="ai-response-container" class="bg-white border-t border-slate-200 no-scrollbar flex flex-col max-w-full">
            <div id="ai-response-header" class="px-6 py-4 max-w-4xl w-full mx-auto"></div>
            <div id="message-list" class="flex-1 overflow-y-auto px-6 space-y-6 max-w-4xl w-full mx-auto pb-6"></div>
        </div>

        <!-- Prompt Bar -->
        <div class="p-4 bg-white border-t border-slate-200 shadow-[0_-2px_5px_rgba(0,0,0,0.05)]">
            <div class="max-w-4xl mx-auto">
                 <form id="prompt-form">
                    <div class="relative">
                        <textarea id="prompt-textarea" rows="1" placeholder="Ask Nexus AI about your workspace..." class="w-full py-3 pl-5 pr-14 text-sm text-slate-800 bg-slate-100 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 border border-transparent transition-all duration-200 max-h-40 overflow-y-auto no-scrollbar"></textarea>
                        <button type="submit" class="absolute bottom-3.5 right-0 flex items-center justify-center w-14 text-slate-500 hover:text-blue-600"><i data-lucide="send" class="h-5 w-5"></i></button>
                    </div>
                 </form>
                 <div id="prompt-suggestions" class="mt-2 flex items-center gap-2">
                    <button class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-600 px-2 py-1 rounded-full">What are my biggest risks?</button>
                    <button class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-600 px-2 py-1 rounded-full">Who is under-utilized?</button>
                    <button class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-600 px-2 py-1 rounded-full">What are the next major deadlines?</button>
                 </div>
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // --- Sidebar Logic ---
            const sidebar = document.getElementById('sidebar');
            sidebar.addEventListener('mouseenter', () => { 
                sidebar.classList.remove('sidebar-collapsed'); 
                sidebar.classList.add('sidebar-expanded'); 
                document.getElementById('logo-text').innerHTML = 'Nexus<span class="text-blue-600">PM</span>'; 
                document.querySelectorAll('.nav-text').forEach(text => text.classList.remove('hidden')); 
            });
            sidebar.addEventListener('mouseleave', () => { 
                sidebar.classList.add('sidebar-collapsed'); 
                sidebar.classList.remove('sidebar-expanded'); 
                document.getElementById('logo-text').innerHTML = 'N<span class="text-blue-600">P</span>'; 
                document.querySelectorAll('.nav-text').forEach(text => text.classList.add('hidden')); 
            });

            // --- Dynamic Sidebar Active State ---
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                const linkPage = link.getAttribute('href');
                if (linkPage === currentPage || (currentPage === '' && linkPage === 'index.html')) {
                    link.classList.add('bg-blue-100', 'text-blue-700', 'font-semibold');
                    link.classList.remove('hover:bg-slate-100', 'text-slate-600');
                } else {
                    link.classList.remove('bg-blue-100', 'text-blue-700', 'font-semibold');
                    link.classList.add('hover:bg-slate-100', 'text-slate-600');
                }
            });

            // --- Notification Bell Logic ---
            const notificationBell = document.getElementById('notification-bell');
            const notificationPanel = document.getElementById('notification-panel');
            notificationBell.addEventListener('click', (e) => {
                e.stopPropagation();
                notificationPanel.classList.toggle('hidden');
            });
            document.addEventListener('click', (e) => {
                if (!notificationPanel.contains(e.target) && !notificationBell.contains(e.target)) {
                    notificationPanel.classList.add('hidden');
                }
            });

            // --- My Hub Task Logic ---
            const taskList = document.getElementById('task-list');
            const newTaskForm = document.getElementById('new-task-form');
            const newTaskInput = document.getElementById('new-task-input');

            taskList.addEventListener('change', (e) => {
                if (e.target.classList.contains('task-checkbox')) {
                    const label = e.target.nextElementSibling;
                    label.classList.toggle('line-through');
                    label.classList.toggle('text-slate-500');
                }
            });
            
            newTaskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const taskText = newTaskInput.value.trim();
                if (taskText === '') return;
                
                const taskId = `task-${Date.now()}`;
                const newTaskHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" id="${taskId}" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3 task-checkbox">
                            <label for="${taskId}" class="font-medium text-sm task-label">${taskText}</label>
                        </div>
                        <span class="text-xs bg-slate-100 text-slate-700 px-2 py-0.5 rounded-full">Pending</span>
                    </div>`;
                taskList.insertAdjacentHTML('beforeend', newTaskHTML);
                newTaskInput.value = '';
            });

            // --- Quick Notes Logic ---
            const notesTextarea = document.getElementById('quick-notes-textarea');
            const savedNotes = localStorage.getItem('nexus-pm-quick-notes');
            if (savedNotes) { notesTextarea.value = savedNotes; }
            notesTextarea.addEventListener('input', () => {
                localStorage.setItem('nexus-pm-quick-notes', notesTextarea.value);
            });
            
            // --- Live Feed Logic ---
            const liveFeedContainer = document.getElementById('live-feed');
            const liveFeedData = [
                { source: 'Jira', link: '#', icon: 'check-circle', color: 'text-blue-500', user: 'Laura', userAvatar: 'laura', action: 'completed issue', target: 'PROJ-123', timestamp: new Date(Date.now() - 5 * 60000), aiContext: 'This unblocks the "Refactor payment gateway" task.' },
                { source: 'Slack', link: '#', icon: 'message-square', color: 'text-purple-500', user: 'Samantha', userAvatar: 'samantha', action: 'mentioned you in', target: '#phoenix-project', timestamp: new Date(Date.now() - 15 * 60000), aiContext: 'A question about the new API schema design.' },
                { source: 'GitHub', link: '#', icon: 'git-commit', color: 'text-gray-700', user: 'David', userAvatar: 'david', action: 'pushed a commit to', target: 'orion-app', timestamp: new Date(Date.now() - 2 * 3600000), aiContext: 'The new user profile page has been deployed to staging.' },
                { source: 'Figma', link: '#', icon: 'figma', color: 'text-pink-500', user: 'Samantha', userAvatar: 'samantha', action: 'updated the file', target: 'Orion App Designs', timestamp: new Date(Date.now() - 5 * 3600000), aiContext: 'Changes reflect feedback from the latest stakeholder review.' },
            ];
            
            function timeAgo(date) {
                const seconds = Math.floor((new Date() - date) / 1000);
                let interval = seconds / 31536000;
                if (interval > 1) return Math.floor(interval) + "y ago";
                interval = seconds / 2592000;
                if (interval > 1) return Math.floor(interval) + "mo ago";
                interval = seconds / 86400;
                if (interval > 1) return Math.floor(interval) + "d ago";
                interval = seconds / 3600;
                if (interval > 1) return Math.floor(interval) + "h ago";
                interval = seconds / 60;
                if (interval > 1) return Math.floor(interval) + "m ago";
                return Math.floor(seconds) + "s ago";
            }

            liveFeedContainer.innerHTML = '';
            liveFeedData.forEach(item => {
                liveFeedContainer.innerHTML += `
                    <div class="feed-item flex space-x-4 relative">
                        <div class="absolute left-5 top-5 h-full w-0.5 bg-slate-200 timeline-line"></div>
                        <div class="flex-shrink-0 z-10">
                            <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center border-2 border-slate-200">
                               <i data-lucide="${item.icon}" class="${item.color} h-5 w-5"></i>
                            </div>
                        </div>
                        <div class="flex-1 pb-4">
                             <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm text-slate-600">
                                        <img src="https://i.pravatar.cc/24?u=${item.userAvatar}" class="inline-block h-6 w-6 rounded-full mr-1"/>
                                        <span class="font-semibold">${item.user}</span>
                                        ${item.action}
                                        <span class="font-semibold text-blue-600">${item.target}</span>.
                                    </p>
                                    <div class="flex items-center mt-1">
                                        <p class="text-xs text-slate-400 flex-shrink-0">${timeAgo(item.timestamp)}</p>
                                        <a href="${item.link}" target="_blank" class="ml-3 text-xs font-semibold text-blue-600 hover:underline flex items-center">
                                            View in ${item.source} <i data-lucide="arrow-up-right" class="h-3 w-3 ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2 text-xs text-slate-500 bg-slate-50 p-2 rounded-md border border-slate-200 flex items-center">
                                <i data-lucide="sparkles" class="h-3 w-3 text-blue-500 mr-2 flex-shrink-0"></i>
                                <strong>AI Context:</strong>&nbsp;<span>${item.aiContext}</span>
                            </div>
                        </div>
                    </div>`;
            });
            lucide.createIcons();


            // --- Priority Email Logic ---
            document.getElementById('analyze-email-btn').addEventListener('click', () => {
                document.getElementById('ai-email-analysis').classList.toggle('hidden');
            });

            document.getElementById('draft-reply-btn').addEventListener('click', () => {
                const recipient = 'eleanor.vance@example.com';
                const subject = 'Re: Feedback on latest designs';
                const body = "Hi Eleanor,\n\nThanks for the feedback on the Orion App designs. I appreciate you highlighting the concern about the onboarding flow complexity.\n\nCould you spare 15 minutes this week to walk me through your specific thoughts? I want to make sure we get it right.\n\nBest,\nAlex";
                window.location.href = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            });

            // --- AI Prompt Bar Logic ---
            const promptForm = document.getElementById('prompt-form');
            const promptTextarea = document.getElementById('prompt-textarea');
            const promptSuggestions = document.getElementById('prompt-suggestions');

            promptSuggestions.addEventListener('click', (e) => {
                if(e.target.tagName === 'BUTTON') {
                    promptTextarea.value = e.target.textContent;
                    promptTextarea.focus();
                    promptForm.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
                }
            });

            const responseContainer = document.getElementById('ai-response-container');
            const responseHeader = document.getElementById('ai-response-header');
            const messageList = document.getElementById('message-list');
            let lastUserQuery = '';
            let isConversationActive = false;

            if (promptForm) {
                promptForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const userQuery = promptTextarea.value.trim();
                    if (!userQuery) return;
                    lastUserQuery = userQuery;
                    if (!isConversationActive) { isConversationActive = true; renderExpandedHeader(); }
                    messageList.insertAdjacentHTML('beforeend', `<div class="flex items-start gap-3 justify-end"><div class="bg-slate-200 p-3 rounded-lg max-w-xl"><p class="text-sm text-slate-800">${userQuery}</p></div><img class="w-8 h-8 rounded-full" src="https://i.pravatar.cc/40?u=nexus-user" alt="User avatar"></div>`);
                    const thinkingId = `thinking-${Date.now()}`;
                    messageList.insertAdjacentHTML('beforeend', `<div id="${thinkingId}" class="flex items-start gap-3"><div class="bg-blue-100 p-2 rounded-full h-8 w-8 flex items-center justify-center animate-pulse flex-shrink-0"><i data-lucide="bot" class="h-5 w-5 text-blue-600"></i></div><div class="bg-slate-100 p-3 rounded-lg"><p class="text-sm text-slate-500">Nexus is thinking...</p></div></div>`);
                    lucide.createIcons();
                    responseContainer.classList.remove('minimized');
                    responseContainer.classList.add('expanded');
                    setTimeout(() => { messageList.scrollTop = messageList.scrollHeight; }, 10);
                    promptTextarea.value = '';
                    promptTextarea.style.height = 'auto';

                    setTimeout(() => {
                        const aiResult = getAIResponse(userQuery);
                        const thinkingElement = document.getElementById(thinkingId);
                        if (thinkingElement) {
                            thinkingElement.outerHTML = `<div class="flex items-start gap-3"><div class="bg-blue-100 p-2 rounded-full h-8 w-8 flex items-center justify-center flex-shrink-0"><i data-lucide="bot" class="h-5 w-5 text-blue-600"></i></div><div class="text-sm text-slate-700 space-y-2 prose prose-sm max-w-none bg-slate-100 p-3 rounded-lg">${aiResult.message}</div></div>`;
                            lucide.createIcons();
                            messageList.scrollTop = messageList.scrollHeight;
                        }
                    }, 1500);
                });
            }
             const renderExpandedHeader = () => {
                responseHeader.innerHTML = `<div class="flex justify-between items-start"><h3 class="text-lg font-semibold text-slate-900">Nexus AI Response</h3><div class="flex items-center"><button id="minimize-ai-response" class="p-1 rounded-full hover:bg-slate-100 mr-2"><i data-lucide="chevrons-down" class="h-5 w-5 text-slate-500"></i></button><button id="close-ai-response" class="p-1 rounded-full hover:bg-slate-100"><i data-lucide="x" class="h-5 w-5 text-slate-500"></i></button></div></div>`;
                lucide.createIcons();
            }
            const renderMinimizedHeader = () => {
                responseHeader.innerHTML = `<div class="flex items-center justify-between h-full"><p class="text-sm text-slate-600 truncate"><span class="font-semibold text-slate-800">AI Response:</span> ${lastUserQuery}</p><button id="expand-ai-response" class="p-1 rounded-full hover:bg-slate-100"><i data-lucide="chevrons-up" class="h-5 w-5 text-slate-500"></i></button></div>`;
                lucide.createIcons();
            }

            if(responseContainer) {
                responseContainer.addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (!button) return;
                    if (button.id === 'close-ai-response') {
                        responseContainer.classList.remove('expanded', 'minimized');
                        messageList.innerHTML = '';
                        responseHeader.innerHTML = '';
                        isConversationActive = false;
                    } else if (button.id === 'minimize-ai-response') {
                        responseContainer.classList.remove('expanded');
                        responseContainer.classList.add('minimized');
                        renderMinimizedHeader();
                    } else if (button.id === 'expand-ai-response') {
                        responseContainer.classList.remove('minimized');
                        responseContainer.classList.add('expanded');
                        renderExpandedHeader();
                        setTimeout(() => { messageList.scrollTop = messageList.scrollHeight; }, 10);
                    }
                });
            }

            function getAIResponse(message) {
                const lowerMessage = message.toLowerCase();
                if (lowerMessage.includes('summarize my day')) {
                    return { message: `<p>Good afternoon, Alex. Today, your top priority is to <strong>Review the API schema</strong>. You also have a meeting with stakeholders tomorrow. Your current workload is at a healthy 75%.</p>` };
                }
                if (lowerMessage.includes('biggest risks')) {
                    return { message: `<p>The biggest risk right now is the <strong>resource overload on Laura (110%)</strong>, which threatens the Phoenix Project timeline. The second is the <strong>Phoenix Project's budget overage (15%)</strong>.</p>` };
                }
                 if (lowerMessage.includes('under-utilized')) {
                    return { message: `<p><strong>David</strong> currently has the most available capacity with a workload of only <strong>40%</strong>. He is a good candidate to take on additional tasks to help balance the team's effort.</p>` };
                }
                 if (lowerMessage.includes('major deadlines')) {
                    return { message: `<p>Your next major deadline is the <strong>Orion App Launch</strong>, which is due in 2 days. After that, the <strong>Phoenix DB Migration</strong> is due in 9 days.</p>` };
                }
                else {
                    return { message: `<p>I can summarize your day, explain risks, or provide details on any project. What would you like to know?</p>` };
                }
            }
        });
    </script>
</body>
</html>

