<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus PM - Activity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        .sidebar {
            transition: width 0.3s ease-in-out;
        }
        .sidebar-collapsed {
            width: 5rem; /* 80px */
        }
        .sidebar-expanded {
            width: 16rem; /* 256px */
        }
        #sidebar.sidebar-collapsed nav a, #sidebar.sidebar-collapsed #user-profile-container {
            justify-content: center;
        }
        .bento-box {
            background-color: #ffffff; /* white */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.5rem;
            border: 1px solid #e2e8f0; /* slate-200 */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        #ai-response-container {
            transition: all 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        #ai-response-container.expanded {
            max-height: 50vh;
        }
        #ai-response-container.minimized {
            max-height: 4rem;
        }
        #ai-response-container.minimized #message-list {
            display: none;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar sidebar-collapsed bg-white border-r border-slate-200 flex flex-col h-full">
        <!-- Logo -->
        <div class="flex items-center justify-center p-4 h-16 border-b border-slate-200">
            <h1 id="logo-text" class="text-2xl font-bold text-slate-800 transition-opacity duration-300">N<span class="text-blue-600">P</span></h1>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-4 space-y-2">
            <a href="index.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="home" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Home</span>
            </a>
            <a href="projects.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="folder-kanban" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Projects</span>
            </a>
            <a href="goals.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="target" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Goals</span>
            </a>
            <a href="intelligence.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="bar-chart-big" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Intelligence</span>
            </a>
             <a href="chat-history.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="message-square" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Chat History</span>
            </a>
            <a href="activity.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="activity" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Activity</span>
            </a>
            <a href="settings.html" class="flex items-center p-3 rounded-lg hover:bg-slate-100 text-slate-600">
                <i data-lucide="settings" class="h-6 w-6"></i>
                <span class="ml-4 nav-text hidden">Settings</span>
            </a>
        </nav>

        <!-- User Profile -->
        <div class="p-4 border-t border-slate-200">
             <div id="user-profile-container" class="flex items-center">
                <img src="https://i.pravatar.cc/40?u=nexus-user" alt="User Avatar" class="rounded-full h-10 w-10">
                <div class="ml-3 overflow-hidden nav-text hidden">
                    <p class="font-semibold text-slate-800 text-sm truncate">Alex Hartman</p>
                    <p class="text-xs text-slate-500 truncate">Product Manager</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 bg-slate-50 flex flex-col overflow-hidden">
        <div id="main-content" class="flex-1 overflow-y-auto overflow-x-hidden p-8">
            <header class="mb-8">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900">Activity Feed</h1>
                    <p class="text-slate-500 mt-1">A unified log of all actions taken by users and Nexus AI across your workspace.</p>
                </div>
            </header>

            <!-- AI Weekly Digest -->
            <div class="bento-box mb-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="sparkles" class="h-6 w-6 text-blue-500"></i>
                        <h3 class="text-xl font-semibold text-slate-900">AI Weekly Digest</h3>
                    </div>
                    <p class="text-xs text-slate-400">Summary for Sep 1 - Sep 7, 2025</p>
                </div>
                <div id="ai-digest-content" class="text-sm text-slate-600 space-y-2">
                    <!-- AI Digest content will be inserted here -->
                </div>
            </div>

            <!-- Filters -->
            <div class="bento-box mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-center">
                    <div class="lg:col-span-2 relative">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"></i>
                        <input type="text" placeholder="Search activities..." class="pl-9 pr-4 py-2 w-full text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <select class="w-full text-sm border border-slate-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"><option>Source: All</option><option>Nexus PM</option><option>Slack</option><option>Jira</option><option>Figma</option><option>Email</option></select>
                    </div>
                     <div>
                        <select class="w-full text-sm border border-slate-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"><option>User: All</option><option>Alex Hartman</option><option>Laura</option><option>Samantha</option><option>David</option><option>Nexus AI</option></select>
                    </div>
                    <div>
                        <input type="date" class="w-full text-sm border border-slate-300 rounded-lg py-2 px-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>
            </div>

            <!-- Activity Timeline -->
            <div id="activity-timeline" class="space-y-8">
                <!-- Activity items will be dynamically inserted here -->
            </div>
        </div>

        <!-- AI Response Container -->
        <div id="ai-response-container" class="bg-white border-t border-slate-200 no-scrollbar flex flex-col max-w-full">
            <div id="ai-response-header" class="px-6 py-4 max-w-4xl w-full mx-auto"></div>
            <div id="message-list" class="flex-1 overflow-y-auto px-6 space-y-6 max-w-4xl w-full mx-auto pb-6"></div>
        </div>

        <!-- Prompt Bar -->
        <div class="p-4 bg-white border-t border-slate-200 shadow-[0_-2px_5px_rgba(0,0,0,0.05)]">
            <div class="max-w-4xl mx-auto">
                 <form id="prompt-form" class="relative">
                    <textarea id="prompt-textarea" rows="1" placeholder="Ask Nexus AI to summarize activity..." class="w-full py-3 pl-5 pr-14 text-sm text-slate-800 bg-slate-100 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 border border-transparent focus:border-blue-500 transition-all duration-200 max-h-40 overflow-y-auto no-scrollbar"></textarea>
                    <button type="submit" class="absolute bottom-3.5 right-0 flex items-center justify-center w-14 text-slate-500 hover:text-blue-600"><i data-lucide="send" class="h-5 w-5"></i></button>
                </form>
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- Sidebar Logic ---
            const sidebar = document.getElementById('sidebar');
            sidebar.addEventListener('mouseenter', () => { 
                sidebar.classList.remove('sidebar-collapsed'); 
                sidebar.classList.add('sidebar-expanded'); 
                document.getElementById('logo-text').innerHTML = 'Nexus<span class="text-blue-600">PM</span>'; 
                document.querySelectorAll('.nav-text').forEach(text => text.classList.remove('hidden')); 
            });
            sidebar.addEventListener('mouseleave', () => { 
                sidebar.classList.add('sidebar-collapsed'); 
                sidebar.classList.remove('sidebar-expanded'); 
                document.getElementById('logo-text').innerHTML = 'N<span class="text-blue-600">P</span>'; 
                document.querySelectorAll('.nav-text').forEach(text => text.classList.add('hidden')); 
            });

            // --- Dynamic Sidebar Active State ---
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const navLinks = document.querySelectorAll('nav a');

            navLinks.forEach(link => {
                const linkPage = link.getAttribute('href');
                link.classList.remove('bg-blue-100', 'text-blue-700', 'font-semibold');
                link.classList.add('hover:bg-slate-100', 'text-slate-600');

                if (linkPage === currentPage) {
                    link.classList.add('bg-blue-100', 'text-blue-700', 'font-semibold');
                    link.classList.remove('hover:bg-slate-100', 'text-slate-600');
                }
            });

            // --- Activity Feed Data & Logic ---
            const activityData = [
                { type: 'user', actor: 'Alex Hartman', actorAvatar: 'nexus-user', action: 'updated the status of', target: 'task "Design new API endpoints"', project: 'Phoenix Project', source: 'Nexus PM', icon: 'check-circle-2', timestamp: '2025-09-06T13:45:00Z', details: 'Moved from To Do to In Progress.' },
                { type: 'ai_insight', title: 'Causality Alert: Potential Bottleneck', details: 'The status update for "Design new API endpoints" to "In Progress" now makes "Refactor payment gateway" the next critical task. However, the assigned resource, <strong>Laura</strong>, is at <strong>110% capacity</strong>. This creates a high probability of a bottleneck forming here.', level: 'warning', icon: 'link-2', timestamp: '2025-09-06T13:46:00Z' },
                { type: 'user', actor: 'Nexus AI', actorAvatar: 'bot', action: 'detected a potential risk in', target: 'project "Phoenix Project"', project: 'Phoenix Project', source: 'Nexus PM', icon: 'alert-triangle', timestamp: '2025-09-06T11:20:00Z', details: 'Budget variance increased to +15%.' },
                { type: 'user', actor: 'Samantha', actorAvatar: 'samantha', action: 'uploaded a new file', target: '"Final_Designs_v3.fig"', project: 'Orion App', source: 'Figma', icon: 'figma', timestamp: '2025-09-05T16:05:00Z' },
                { type: 'ai_insight', title: 'Sentiment Drop Detected in "Phoenix Project"', details: 'Sentiment analysis of recent Jira comments shows a <strong>25% drop</strong> in positive sentiment, primarily related to discussions around the payment gateway. This may indicate growing team frustration or technical challenges.', level: 'danger', icon: 'message-circle-off', timestamp: '2025-09-05T11:00:00Z' },
                { type: 'user', actor: 'Laura', actorAvatar: 'laura', action: 'commented on', target: 'issue "PROJ-124"', project: 'Phoenix Project', source: 'Jira', icon: 'message-square', timestamp: '2025-09-05T10:30:00Z', details: '"This seems to be a blocker for the payment gateway refactor. Can we prioritize?"' },
                { type: 'user', actor: 'David', actorAvatar: 'david', action: 'pushed a commit to', target: 'repository "orion-app-frontend"', project: 'Orion App', source: 'GitHub', icon: 'git-commit', timestamp: '2025-09-04T17:00:00Z', details: 'feat: implement user profile page' },
                { type: 'user', actor: 'Nexus AI', actorAvatar: 'bot', action: 'generated a new report', target: '"Q3 Budget Forecast"', project: 'All Projects', source: 'Nexus PM', icon: 'file-text', timestamp: '2025-09-04T09:00:00Z' },
            ];

            function loadAIDigest() {
                const digestContent = document.getElementById('ai-digest-content');
                digestContent.innerHTML = `
                    <p>Nexus AI identified <strong>2 major anomalies</strong> this week, including a significant sentiment drop in the Phoenix Project. <strong>3 key decisions</strong> were logged based on AI-surfaced data. The overall project portfolio health is trending slightly down by <strong>-4%</strong> week-over-week, primarily due to emerging risks in the Phoenix Project.</p>
                `;
            }

            function loadActivityFeed() {
                const timeline = document.getElementById('activity-timeline');
                
                const groupedByDate = activityData.reduce((acc, item) => {
                    const date = new Date(item.timestamp).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    if (!acc[date]) acc[date] = [];
                    acc[date].push(item);
                    return acc;
                }, {});

                timeline.innerHTML = ''; // Clear previous items

                const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const yesterday = new Date(Date.now() - 86400000).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                for (const date in groupedByDate) {
                    let displayDate = date;
                    if (date === today) displayDate = 'Today';
                    if (date === yesterday) displayDate = 'Yesterday';

                    let dateGroupHTML = `<div class="date-group"><h3 class="text-lg font-semibold text-slate-800 mb-4">${displayDate}</h3><div class="space-y-4">`;

                    groupedByDate[date].forEach(item => {
                        if (item.type === 'ai_insight') {
                            const levelColors = { 'warning': 'border-yellow-400 bg-yellow-50', 'danger': 'border-red-400 bg-red-50' };
                            dateGroupHTML += `
                                <div class="bento-box border-l-4 ${levelColors[item.level] || 'border-blue-400 bg-blue-50'}">
                                    <div class="flex items-start space-x-4">
                                        <i data-lucide="bot" class="h-5 w-5 text-blue-600 flex-shrink-0 mt-1"></i>
                                        <div class="flex-1">
                                            <p class="font-semibold text-sm text-slate-800">${item.title}</p>
                                            <p class="text-xs text-slate-600 mt-1">${item.details}</p>
                                        </div>
                                        <i data-lucide="${item.icon}" class="h-5 w-5 text-slate-400 flex-shrink-0"></i>
                                    </div>
                                </div>`;
                        } else {
                            const sourceColors = { 'Nexus PM': 'bg-blue-100 text-blue-800', 'Slack': 'bg-purple-100 text-purple-800', 'Jira': 'bg-sky-100 text-sky-800', 'Figma': 'bg-pink-100 text-pink-800', 'GitHub': 'bg-gray-100 text-gray-800' };
                            dateGroupHTML += `
                                <div class="flex items-start space-x-4">
                                    <div class="bg-white p-2 rounded-full border">
                                        <img src="https://i.pravatar.cc/32?u=${item.actorAvatar}" class="h-5 w-5 rounded-full" />
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm">
                                            <span class="font-semibold">${item.actor}</span> ${item.action} <span class="font-semibold text-blue-600">${item.target}</span>
                                        </p>
                                        <div class="flex items-center space-x-2 text-xs text-slate-500 mt-1">
                                            <span>${new Date(item.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</span>
                                            <span>&middot;</span>
                                            <span>${item.project}</span>
                                            <span>&middot;</span>
                                            <span class="px-2 py-0.5 rounded-full text-xs font-medium ${sourceColors[item.source] || 'bg-slate-100 text-slate-800'}">${item.source}</span>
                                        </div>
                                        ${item.details ? `<div class="mt-2 text-xs text-slate-600 bg-slate-100 p-2 rounded-md border border-slate-200">${item.details}</div>` : ''}
                                    </div>
                                </div>
                            `;
                        }
                    });

                    dateGroupHTML += `</div></div>`;
                    timeline.innerHTML += dateGroupHTML;
                }

                lucide.createIcons();
            }
            
            loadAIDigest();
            loadActivityFeed();

            // --- AI Prompt Bar Logic ---
            const promptForm = document.getElementById('prompt-form');
            const responseContainer = document.getElementById('ai-response-container');
            const responseHeader = document.getElementById('ai-response-header');
            const messageList = document.getElementById('message-list');
            let lastUserQuery = '';
            let isConversationActive = false;

            if (promptForm) {
                promptForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const userQuery = document.getElementById('prompt-textarea').value.trim();
                    if (!userQuery) return;
                    lastUserQuery = userQuery;
                    if (!isConversationActive) { isConversationActive = true; renderExpandedHeader(); }
                    messageList.insertAdjacentHTML('beforeend', `<div class="flex items-start gap-3 justify-end"><div class="bg-slate-200 p-3 rounded-lg max-w-xl"><p class="text-sm text-slate-800">${userQuery}</p></div><img class="w-8 h-8 rounded-full" src="https://i.pravatar.cc/40?u=nexus-user" alt="User avatar"></div>`);
                    const thinkingId = `thinking-${Date.now()}`;
                    messageList.insertAdjacentHTML('beforeend', `<div id="${thinkingId}" class="flex items-start gap-3"><div class="bg-blue-100 p-2 rounded-full h-8 w-8 flex items-center justify-center animate-pulse flex-shrink-0"><i data-lucide="bot" class="h-5 w-5 text-blue-600"></i></div><div class="bg-slate-100 p-3 rounded-lg"><p class="text-sm text-slate-500">Nexus is thinking...</p></div></div>`);
                    lucide.createIcons();
                    responseContainer.classList.remove('minimized');
                    responseContainer.classList.add('expanded');
                    setTimeout(() => { messageList.scrollTop = messageList.scrollHeight; }, 10);
                    document.getElementById('prompt-textarea').value = '';
                    document.getElementById('prompt-textarea').style.height = 'auto';

                    setTimeout(() => {
                        const aiResult = getAIResponse(userQuery);
                        const thinkingElement = document.getElementById(thinkingId);
                        if (thinkingElement) {
                            thinkingElement.outerHTML = `<div class="flex items-start gap-3"><div class="bg-blue-100 p-2 rounded-full h-8 w-8 flex items-center justify-center flex-shrink-0"><i data-lucide="bot" class="h-5 w-5 text-blue-600"></i></div><div class="text-sm text-slate-700 space-y-2 prose prose-sm max-w-none bg-slate-100 p-3 rounded-lg">${aiResult.message}</div></div>`;
                            lucide.createIcons();
                            messageList.scrollTop = messageList.scrollHeight;
                        }
                    }, 1500);
                });
            }

            const renderExpandedHeader = () => {
                responseHeader.innerHTML = `<div class="flex justify-between items-start"><h3 class="text-lg font-semibold text-slate-900">Nexus AI Response</h3><div class="flex items-center"><button id="minimize-ai-response" class="p-1 rounded-full hover:bg-slate-100 mr-2"><i data-lucide="chevrons-down" class="h-5 w-5 text-slate-500"></i></button><button id="close-ai-response" class="p-1 rounded-full hover:bg-slate-100"><i data-lucide="x" class="h-5 w-5 text-slate-500"></i></button></div></div>`;
                lucide.createIcons();
            }
            const renderMinimizedHeader = () => {
                responseHeader.innerHTML = `<div class="flex items-center justify-between h-full"><p class="text-sm text-slate-600 truncate"><span class="font-semibold text-slate-800">AI Response:</span> ${lastUserQuery}</p><button id="expand-ai-response" class="p-1 rounded-full hover:bg-slate-100"><i data-lucide="chevrons-up" class="h-5 w-5 text-slate-500"></i></button></div>`;
                lucide.createIcons();
            }

            if(responseContainer) {
                responseContainer.addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (!button) return;
                    if (button.id === 'close-ai-response') {
                        responseContainer.classList.remove('expanded', 'minimized');
                        messageList.innerHTML = '';
                        responseHeader.innerHTML = '';
                        isConversationActive = false;
                    } else if (button.id === 'minimize-ai-response') {
                        responseContainer.classList.remove('expanded');
                        responseContainer.classList.add('minimized');
                        renderMinimizedHeader();
                    } else if (button.id === 'expand-ai-response') {
                        responseContainer.classList.remove('minimized');
                        responseContainer.classList.add('expanded');
                        renderExpandedHeader();
                        setTimeout(() => { messageList.scrollTop = messageList.scrollHeight; }, 10);
                    }
                });
            }

            function getAIResponse(message) {
                const lowerMessage = message.toLowerCase();
                if (lowerMessage.includes('sentiment')) {
                    return { message: `<p>The <strong>Sentiment Drop</strong> in the Phoenix Project was detected after analyzing several Jira comments, including one from Laura expressing concern about a blocker. This pattern often precedes delays, so I flagged it as a high-priority insight.</p>` };
                }
                if (lowerMessage.includes('today')) {
                    return { message: `<p>Here's a summary of today's activity:</p><ul class="list-disc list-inside mt-2 text-sm"><li><strong>Alex Hartman</strong> updated a task in the Phoenix Project.</li><li><strong>Nexus AI</strong> detected a new budget risk in the Phoenix Project and a potential bottleneck caused by Alex's update.</li></ul>` };
                }
                if (lowerMessage.includes('phoenix project')) {
                    return { message: `<p>Recent activity for the <strong>Phoenix Project</strong> includes a status update by Alex, a risk detection by Nexus AI, and a comment in Jira by Laura. It seems to be the most active project today.</p>` };
                }
                else {
                    return { message: `<p>I can summarize recent activity for a specific project, user, or time frame. What would you like to know?</p>` };
                }
            }
        });
    </script>
</body>
</html>

